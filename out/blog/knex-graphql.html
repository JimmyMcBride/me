<!DOCTYPE html><html><head><title>Knex - Graphql Back End</title><meta charSet="utf-8"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/5df09a138bf0aa5ad6c8.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5df09a138bf0aa5ad6c8.css"/><link rel="preload" href="/_next/static/djspI5cbhoNIr1gQ0JfZ5/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/djspI5cbhoNIr1gQ0JfZ5/pages/blog/%5Bslug%5D.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-82ddb892a7a91d6a66f3.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.619a4f70c1d4d3a29cbc.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.020a96d8a8e71e9e3362.js" as="script"/><link rel="preload" href="/_next/static/chunks/792eb8e10b0b712eaf3753027d88348260e5e63e.220af247f944fe68df45.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-4fb50e6bc8c6ab86b450.js" as="script"/><link rel="preload" href="/_next/static/chunks/2cc12690752c0743c3251b7e9d03aa30fdaf36be.621712edcf76e83570b7.js" as="script"/><link rel="preload" href="/_next/static/chunks/38eba6aa7053191cc3fbc1914b92542e4afeff03.66c8a9ef5066908662e5.js" as="script"/></head><body><div id="__next"><div class="sc-AxhCb jtNhsl app"><div class="sc-AxhUy fBehBg"><header><nav class="sc-AxgMl dlYQUF"><div class="sc-AxheI cjWxgz"><div class="sc-fzpans fOCMEK nav-cabinet-menu"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true" style="font-size:3.8rem"><path d="M4 18h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1zm0-5h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1zM3 7c0 .55.45 1 1 1h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1z"></path></svg></div><div class="sc-fzpans gZVQjm nav-link-list"><div class="sc-AxheI fTDoFh"><div wrap="true" class="sc-AxheI fbCQkv"><a color="#212121" href="/" class="sc-fznyAO hKmFPJ">Home</a></div><div class="sc-fzpans jvRvXJ"></div><div class="sc-AxheI eamfOm"><a color="#212121" href="/blog" class="sc-fznyAO hKmFPJ">Blog</a></div><div class="sc-fzpans jvRvXJ"></div><div class="sc-AxheI eamfOm"><a color="#212121" href="/projects" class="sc-fznyAO hKmFPJ">Projects</a></div></div></div><div class="sc-AxheI cbYAmZ"><p color="#212121" class="sc-fznyAO ivsuzr my-name">Jimmy McBride</p><div class="sc-fzpans jvRvXJ"></div><div class="sc-fzpans gnQGOe"><img src="/jimicon.png" alt="me"/></div></div></div></nav></header><div class="sc-AxiKw eSbheu"><div class="overlay-in-active"></div><div class="sc-fzoLsD eyGHPX cabinet in-active"><div class="sc-AxheI hfWwIi"><div wrap="true" class="sc-AxheI fbCQkv"><a color="#212121" href="/" class="sc-fznyAO hKmFPJ">Home</a></div><div class="sc-fzpans jvRvXJ"></div><div class="sc-AxheI eamfOm"><a color="#212121" href="/blog" class="sc-fznyAO hKmFPJ">Blog</a></div><div class="sc-fzpans jvRvXJ"></div><div class="sc-AxheI eamfOm"><a color="#212121" href="/projects" class="sc-fznyAO hKmFPJ">Projects</a></div></div></div></div><div class="sc-AxheI bCSRuK"><div class="sc-fzpans fwruOa"></div><div class="sc-fzpans gZVQjm"></div><div class="sc-fzoLsD aZHrz"><div class="sc-fzpans kpPNRs"><div class="markdown-body"><h2>How To Create A Knex / Graphql Back End ðŸ–¥</h2><p><img alt="Banner" src="https://i.imgur.com/yiDtHBp.png"/></p><h3>Step 1</h3><p>Create a project directory. <code>mkdir knex-graphql</code>.</p><p>Then run <code>yarn init</code>. When it asks your for the main file, add <code>src/index.js</code>.</p><p>Now that have that ready we can star adding the dependencies we&#x27;re going to need.</p><blockquote><p>Graphql has a rich ecosystem with many amazing options. Feel free to experiment with the plethora of amazing graphql tools out there!</p></blockquote><p><code>yarn add -D nodemon dotenv</code></p><p><code>yarn add express apollo-server-express graphql knex pg</code></p><p>There&#x27;s a few things we don&#x27;t want to push up to our GitHub repo. <code>touch .gitignore</code> in the root of your repo and add:</p><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#212121"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Space Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">node_modules/
.env
yarn-error.log</code></pre><p>Now that we have all our tools added, let&#x27;s set up out database!</p><h3>Step 2</h3><p>Let&#x27;s create a sql file and set up some scripts in our package.json.</p><p><code>touch remakeDatabase.sql</code></p><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#212121"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Space Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">DROP DATABASE IF EXISTS my_db;

CREATE DATABASE my_db;</code></pre><p>Open package.json and these scripts:</p><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#212121"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Space Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">{
  &quot;scripts&quot;: {
    &quot;start&quot;: &quot;node src/index.js&quot;,
    &quot;server&quot;: &quot;nodemon src/index.js&quot;,
    &quot;db-remake&quot;: &quot;psql -f remakeDatabase.sql&quot;
  }
}</code></pre><p>Now we can use the command <code>yarn db-remake</code> anytime we want to rollback our database.</p><h3>Step 3</h3><p>It&#x27;s time to get knex set up! In root directory, run: <code>knex init</code>. We don&#x27;t need everything in here, so we&#x27;re just going to delete staging and testing environments and set knex up to work with postgres.</p><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#212121"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Space Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">// knexfile.js
require(&quot;dotenv&quot;).config();

module.exports = {
  development: {
    client: &quot;pg&quot;,
    connection: process.env.DATABASE_URL,
    migrations: {
      directory: &quot;./src/data/migrations&quot;,
    },
    seeds: {
      directory: &quot;./src/data/seeds&quot;,
    },
  },
};</code></pre><p>We set our migration and build folders, let&#x27;s make our data folder with the command <code>mkdir src/data</code>. Now that we have that in place, let&#x27;s set up our migrations and seeds. ðŸŒ±</p><p>Run: <code>knex migrate:make users_table &amp;&amp; knex seed:make 01_users</code>.</p><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#212121"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Space Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">// migration file
exports.up = function (knex) {
  return knex.schema.createTable(&quot;users&quot;, (tbl) =&gt; {
    tbl.increments();
    tbl.text(&quot;username&quot;).notNullable();
    tbl.text(&quot;email&quot;).notNullable();
    tbl.boolean(&quot;admin&quot;).default(false);
  });
};

exports.down = function (knex) {
  return knex.schema.dropTableIfExists(&quot;users&quot;);
};</code></pre><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#212121"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Space Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">// seed file
exports.seed = function (knex) {
  // Deletes ALL existing entries
  return knex(&quot;users&quot;)
    .del()
    .then(function () {
      // Inserts seed entries
      return knex(&quot;users&quot;).insert([
        { id: 1, username: &quot;rowValue1&quot;, email: &quot;email1@email.com&quot; },
        { id: 2, username: &quot;rowValue2&quot;, email: &quot;email2@email.com&quot; },
        { id: 3, username: &quot;rowValue3&quot;, email: &quot;email3@email.com&quot; },
      ]);
    });
};</code></pre><p>We have our migrations and seeds set up now, let&#x27;s run them and make sure everything is great. We can make our life a little easier by adding 2 more scripts to our package.json.</p><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#212121"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Space Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">{
  &quot;scripts&quot;: {
    &quot;start&quot;: &quot;node src/index.js&quot;,
    &quot;server&quot;: &quot;nodemon src/index.js&quot;,
    &quot;db-remake&quot;: &quot;psql -f remakeDatabase.sql&quot;,
    &quot;knex-refresh&quot;: &quot;knex migrate:rollback &amp;&amp; knex migrate:latest &amp;&amp; knex seed:run&quot;,
    &quot;total-reset&quot;: &quot;yarn db-remake &amp;&amp; yarn knex-refresh&quot;
  }
}</code></pre><p>You probably we added <code>knex-refresh</code> and <code>total-reset</code>. Knex refresh command refreshes our migrations and runs our seeds in one command. If we make any changes to schema that breaks our postgres tables, we can just roll the whole thing back, database and all before we run our new migrations as seeds.</p><p>One <strong>final</strong> thing. We need to <code>touch src/data/knexConfig.js</code> and add the following code to it:</p><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#212121"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Space Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">const knex = require(&quot;knex&quot;);
const knexConfig = require(&quot;../../knexfile&quot;);

module.exports = knex(knexConfig.development);</code></pre><h3>Step 4</h3><p>In our package.json we have our main file set as <code>src/index.js</code>. Let&#x27;s set that up. Run: <code>mkdir src &amp;&amp; touch src/index.js</code>.</p><p>Before we set up our index.js, let&#x27;s add a couple env variables we will need.</p><p>Create a .env file in the root of your project and add:</p><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#212121"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Space Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">PORT = 4000
DATABASE_URL = postgres://postgres:password@localhost:5432/my_db</code></pre><p>Now that that we have those variables in place, let&#x27;s write some code! ðŸ”¥</p><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#212121"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Space Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">// src/index.js
const { ApolloServer, gql } = require(&quot;apollo-server-express&quot;);
const express = require(&quot;express&quot;);

const db = require(&quot;./data/config&quot;);
const app = express();

require(&quot;dotenv&quot;).config();

const port = process.env.PORT;

// typeDefs is where we define what our schema looks like
const typeDefs = gql`
  type User {
    id: ID!
    username: String!
    email: String!
    admin: Boolean!
  }
  type Query {
    users: [User]!
    user(id: ID!): User!
  }
`;

// resolvers are where we put the logic to make our typeDefs come to life
const resolvers = {
  Query: {
    users(parent, args, ctx) {
      return db(&quot;users&quot;);
    },
    user(_, { id }) {
      return db(&quot;users&quot;).where({ id }).first();
    },
  },
};

const server = new ApolloServer({
  typeDefs,
  resolvers,
});

server.applyMiddleware({ app });

app.listen(port, () =&gt;
  console.log(`ðŸ–¥ Server ready on http://localhost:${port}/grahql ðŸš€`)
);</code></pre><p>And that&#x27;s it! We have a fully functional graphql server up in minutes! ðŸ”¥ Woo hoo!</p></div></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"htmlString":"\n## How To Create A Knex / Graphql Back End ðŸ–¥\n\n![Banner](https://i.imgur.com/yiDtHBp.png)\n\n### Step 1\n\nCreate a project directory. `mkdir knex-graphql`.\n\nThen run `yarn init`. When it asks your for the main file, add `src/index.js`.\n\nNow that have that ready we can star adding the dependencies we're going to need.\n\n\u003e Graphql has a rich ecosystem with many amazing options. Feel free to experiment with the plethora of amazing graphql tools out there!\n\n`yarn add -D nodemon dotenv`\n\n`yarn add express apollo-server-express graphql knex pg`\n\nThere's a few things we don't want to push up to our GitHub repo. `touch .gitignore` in the root of your repo and add:\n\n```bash\nnode_modules/\n.env\nyarn-error.log\n```\n\nNow that we have all our tools added, let's set up out database!\n\n### Step 2\n\nLet's create a sql file and set up some scripts in our package.json.\n\n`touch remakeDatabase.sql`\n\n```sql\nDROP DATABASE IF EXISTS my_db;\n\nCREATE DATABASE my_db;\n```\n\nOpen package.json and these scripts:\n\n```json\n{\n  \"scripts\": {\n    \"start\": \"node src/index.js\",\n    \"server\": \"nodemon src/index.js\",\n    \"db-remake\": \"psql -f remakeDatabase.sql\"\n  }\n}\n```\n\nNow we can use the command `yarn db-remake` anytime we want to rollback our database.\n\n### Step 3\n\nIt's time to get knex set up! In root directory, run: `knex init`. We don't need everything in here, so we're just going to delete staging and testing environments and set knex up to work with postgres.\n\n```javascript\n// knexfile.js\nrequire(\"dotenv\").config();\n\nmodule.exports = {\n  development: {\n    client: \"pg\",\n    connection: process.env.DATABASE_URL,\n    migrations: {\n      directory: \"./src/data/migrations\",\n    },\n    seeds: {\n      directory: \"./src/data/seeds\",\n    },\n  },\n};\n```\n\nWe set our migration and build folders, let's make our data folder with the command `mkdir src/data`. Now that we have that in place, let's set up our migrations and seeds. ðŸŒ±\n\nRun: `knex migrate:make users_table \u0026\u0026 knex seed:make 01_users`.\n\n```javascript\n// migration file\nexports.up = function (knex) {\n  return knex.schema.createTable(\"users\", (tbl) =\u003e {\n    tbl.increments();\n    tbl.text(\"username\").notNullable();\n    tbl.text(\"email\").notNullable();\n    tbl.boolean(\"admin\").default(false);\n  });\n};\n\nexports.down = function (knex) {\n  return knex.schema.dropTableIfExists(\"users\");\n};\n```\n\n```javascript\n// seed file\nexports.seed = function (knex) {\n  // Deletes ALL existing entries\n  return knex(\"users\")\n    .del()\n    .then(function () {\n      // Inserts seed entries\n      return knex(\"users\").insert([\n        { id: 1, username: \"rowValue1\", email: \"email1@email.com\" },\n        { id: 2, username: \"rowValue2\", email: \"email2@email.com\" },\n        { id: 3, username: \"rowValue3\", email: \"email3@email.com\" },\n      ]);\n    });\n};\n```\n\nWe have our migrations and seeds set up now, let's run them and make sure everything is great. We can make our life a little easier by adding 2 more scripts to our package.json.\n\n```json\n{\n  \"scripts\": {\n    \"start\": \"node src/index.js\",\n    \"server\": \"nodemon src/index.js\",\n    \"db-remake\": \"psql -f remakeDatabase.sql\",\n    \"knex-refresh\": \"knex migrate:rollback \u0026\u0026 knex migrate:latest \u0026\u0026 knex seed:run\",\n    \"total-reset\": \"yarn db-remake \u0026\u0026 yarn knex-refresh\"\n  }\n}\n```\n\nYou probably we added `knex-refresh` and `total-reset`. Knex refresh command refreshes our migrations and runs our seeds in one command. If we make any changes to schema that breaks our postgres tables, we can just roll the whole thing back, database and all before we run our new migrations as seeds.\n\nOne **final** thing. We need to `touch src/data/knexConfig.js` and add the following code to it:\n\n```javascript\nconst knex = require(\"knex\");\nconst knexConfig = require(\"../../knexfile\");\n\nmodule.exports = knex(knexConfig.development);\n```\n\n### Step 4\n\nIn our package.json we have our main file set as `src/index.js`. Let's set that up. Run: `mkdir src \u0026\u0026 touch src/index.js`.\n\nBefore we set up our index.js, let's add a couple env variables we will need.\n\nCreate a .env file in the root of your project and add:\n\n```bash\nPORT = 4000\nDATABASE_URL = postgres://postgres:password@localhost:5432/my_db\n```\n\nNow that that we have those variables in place, let's write some code! ðŸ”¥\n\n```javascript\n// src/index.js\nconst { ApolloServer, gql } = require(\"apollo-server-express\");\nconst express = require(\"express\");\n\nconst db = require(\"./data/config\");\nconst app = express();\n\nrequire(\"dotenv\").config();\n\nconst port = process.env.PORT;\n\n// typeDefs is where we define what our schema looks like\nconst typeDefs = gql`\n  type User {\n    id: ID!\n    username: String!\n    email: String!\n    admin: Boolean!\n  }\n  type Query {\n    users: [User]!\n    user(id: ID!): User!\n  }\n`;\n\n// resolvers are where we put the logic to make our typeDefs come to life\nconst resolvers = {\n  Query: {\n    users(parent, args, ctx) {\n      return db(\"users\");\n    },\n    user(_, { id }) {\n      return db(\"users\").where({ id }).first();\n    },\n  },\n};\n\nconst server = new ApolloServer({\n  typeDefs,\n  resolvers,\n});\n\nserver.applyMiddleware({ app });\n\napp.listen(port, () =\u003e\n  console.log(`ðŸ–¥ Server ready on http://localhost:${port}/grahql ðŸš€`)\n);\n```\n\nAnd that's it! We have a fully functional graphql server up in minutes! ðŸ”¥ Woo hoo!\n","data":{"title":"Knex - Graphql Back End","image":"https://i.imgur.com/yiDtHBp.png","description":"Firebase is an incredible platform to connect any iOS, android and/or web app too.  By connecting your project to Google's Firebase you will have access to their cloud storage, cloud firestore and real-time database, authentication, analytics and much more."}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"knex-graphql"},"buildId":"djspI5cbhoNIr1gQ0JfZ5","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/runtime/polyfills-2176b8fd390f794ddf9e.js"></script><script async="" data-next-page="/_app" src="/_next/static/djspI5cbhoNIr1gQ0JfZ5/pages/_app.js"></script><script async="" data-next-page="/blog/[slug]" src="/_next/static/djspI5cbhoNIr1gQ0JfZ5/pages/blog/%5Bslug%5D.js"></script><script src="/_next/static/runtime/webpack-82ddb892a7a91d6a66f3.js" async=""></script><script src="/_next/static/chunks/framework.619a4f70c1d4d3a29cbc.js" async=""></script><script src="/_next/static/chunks/commons.020a96d8a8e71e9e3362.js" async=""></script><script src="/_next/static/chunks/792eb8e10b0b712eaf3753027d88348260e5e63e.220af247f944fe68df45.js" async=""></script><script src="/_next/static/runtime/main-4fb50e6bc8c6ab86b450.js" async=""></script><script src="/_next/static/chunks/2cc12690752c0743c3251b7e9d03aa30fdaf36be.621712edcf76e83570b7.js" async=""></script><script src="/_next/static/chunks/38eba6aa7053191cc3fbc1914b92542e4afeff03.66c8a9ef5066908662e5.js" async=""></script><script src="/_next/static/djspI5cbhoNIr1gQ0JfZ5/_buildManifest.js" async=""></script><script src="/_next/static/djspI5cbhoNIr1gQ0JfZ5/_ssgManifest.js" async=""></script></body></html>